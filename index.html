<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thumbnail Master 11.0 - Image Opacity Edition</title>
    
    <!-- í°íŠ¸ ë¡œë“œ -->
    <link rel="stylesheet" type="text/css" href="https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareNeo/NanumSquareNeo.css">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    
    <style>
        /* ì¶”ê°€ í°íŠ¸ ì •ì˜ */
        @font-face { font-family: 'PyeongChangPeace-Bold'; src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2206-02@1.0/PyeongChangPeace-Bold.woff2') format('woff2'); }
        @font-face { font-family: 'ChosunGu'; src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@1.0/ChosunGu.woff') format('woff'); }
        @font-face { font-family: 'KOTRA_HOPE'; src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_20-10-21@1.0/KOTRA_HOPE.woff') format('woff'); }
        @font-face { font-family: 'Hahmlet-Bold'; src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2110@1.0/Hahmlet-Bold.woff2') format('woff2'); }
        @font-face { font-family: 'Galmuri11'; src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2207-01@1.1/Galmuri11.woff2') format('woff2'); }
        @font-face { font-family: 'TmonMonsori'; src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/TmonMonsori.woff') format('woff'); }
        @font-face { font-family: 'GmarketSansBold'; src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansBold.woff') format('woff'); }
        @font-face { font-family: 'Esamanru'; src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@2.1/EsamanruBold.woff') format('woff'); }

        :root {
            --bg-main: #f1f5f9;
            --sidebar-bg: #ffffff;
            --accent: #3b82f6;
            --border: #e2e8f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'NanumSquareNeo', sans-serif; letter-spacing: -0.02em; }
        body { background-color: var(--bg-main); display: flex; height: 100vh; overflow: hidden; }

        /* ì‚¬ì´ë“œë°” */
        .sidebar { width: 500px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; height: 100%; overflow-y: auto; }
        .sidebar-header { padding: 20px 30px; border-bottom: 1px solid var(--border); background: #fff; position: sticky; top: 0; z-index: 10; }
        .sidebar-header h1 { font-size: 18px; font-weight: 900; color: #333; }
        
        .config-section { padding: 20px 30px; border-bottom: 1px solid var(--border); }
        .config-title { font-size: 11px; font-weight: 800; color: #94a3b8; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; }

        textarea { width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 10px; font-size: 15px; font-weight: 700; resize: none; min-height: 80px; background: #f8fafc; }

        /* ì •ë ¬ ë²„íŠ¼ */
        .align-group { display: flex; gap: 8px; margin-top: 8px; }
        .align-btn { flex: 1; height: 40px; border: 2px solid var(--border); border-radius: 8px; background: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .align-btn svg { width: 18px; height: 18px; fill: #64748b; }
        .align-btn.active { background: #333; border-color: #333; }
        .align-btn.active svg { fill: #fff; }

        .select, .hex-input { width: 100%; height: 42px; padding: 0 10px; border: 2px solid var(--border); border-radius: 8px; font-size: 13px; font-weight: 700; background: #fff; }

        /* ì‚¬ì§„ ì—…ë¡œë“œ ë²„íŠ¼ */
        .file-label { display: block; width: 100%; padding: 12px; background: #f1f5f9; border: 2px dashed #cbd5e1; border-radius: 10px; text-align: center; cursor: pointer; font-size: 13px; font-weight: 800; color: #64748b; transition: 0.2s; }
        .file-label:hover { background: #e2e8f0; border-color: #94a3b8; }
        #image-upload { display: none; }

        /* í”„ë¦¬ì…‹ ê·¸ë¦¬ë“œ */
        .preset-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; }
        .preset-card { border: 2px solid var(--border); border-radius: 6px; padding: 4px; cursor: pointer; text-align: center; transition: 0.2s; }
        .preset-card:hover { border-color: #333; }
        .preset-box { width: 100%; height: 25px; border-radius: 4px; margin-bottom: 4px; }
        .preset-label { font-size: 8px; font-weight: 800; color: #64748b; }

        /* ë©”ì¸ ì˜ì—­ */
        .main-content { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; justify-content: center; }
        .preview-wrap { background: #fff; padding: 15px; border-radius: 20px; box-shadow: 0 30px 60px rgba(0,0,0,0.1); }
        canvas { width: 450px; height: 450px; border-radius: 10px; display: block; }

        .btn-download { width: 100%; max-width: 450px; margin-top: 20px; padding: 18px; background: #000; color: #fff; border: none; border-radius: 14px; font-size: 16px; font-weight: 900; cursor: pointer; }

        .range-wrap { margin-bottom: 12px; }
        .range-header { display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 11px; font-weight: 800; color: #94a3b8; }
        .range-val { color: #333; }
        input[type="range"] { width: 100%; accent-color: #333; cursor: pointer; }

        .color-group { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
        .color-input { width: 40px; height: 40px; padding: 2px; border: 2px solid var(--border); border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

<aside class="sidebar">
    <div class="sidebar-header">
        <h1>Thumbnail Master 11.0</h1>
    </div>

    <!-- 1. í…ìŠ¤íŠ¸ ì„¤ì • -->
    <div class="config-section">
        <div class="config-title">í…ìŠ¤íŠ¸ í¸ì§‘ ë° ì •ë ¬</div>
        <textarea id="text-input">ì…ë ¥í•˜ì†Œì„œ..</textarea>
        <div class="align-group">
            <button class="align-btn" data-align="left"><svg viewBox="0 0 24 24"><path d="M3 15h18v-2H3v2zm0 4h18v-2H3v2zm0-8h18V9H3v2zm0-6v2h18V5H3z"/></svg></button>
            <button class="align-btn active" data-align="center"><svg viewBox="0 0 24 24"><path d="M7 15h10v-2H7v2zm-4 4h18v-2H3v2zm4-8h10V9H7v2zm-4-6v2h18V5H3z"/></svg></button>
            <button class="align-btn" data-align="right"><svg viewBox="0 0 24 24"><path d="M3 15h18v-2H3v2zm0 4h18v-2H3v2zm0-8h18V9H3v2zm0-6v2h18V5H3z" transform="scale(-1, 1) translate(-24, 0)"/></svg></button>
        </div>
    </div>

    <!-- 2. ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì • -->
    <div class="config-section">
        <div class="config-title">ë°°ê²½ ì‚¬ì§„ ë° ë¶ˆíˆ¬ëª…ë„</div>
        <label for="image-upload" class="file-label">ğŸ“ ë‚´ ì»´í“¨í„° ì‚¬ì§„ ì—…ë¡œë“œ<br>ìƒˆë¡œê³ ì¹¨í•˜ë©´ ë‚ ë¼ê°€ìœ </label>
        <input type="file" id="image-upload" accept="image/*">
        
        <div style="margin-top:15px;">
            <div class="range-wrap">
                <div class="range-header"><span>ì‚¬ì§„ ë¶ˆíˆ¬ëª…ë„ (Opacity)</span><span class="range-val" id="opacity-val">100%</span></div>
                <input type="range" id="image-opacity" min="0" max="100" value="100">
            </div>
        </div>
        <button onclick="resetImage()" style="font-size:10px; border:none; background:none; color:#f43f5e; cursor:pointer; font-weight:800;">ì‚¬ì§„ ì‚­ì œ í›„ ë°°ê²½ìƒ‰ë§Œ ì‚¬ìš©</button>
    </div>

    <!-- 3. ì„œì²´ ì„¤ì • -->
    <div class="config-section">
        <div class="config-title">ì„œì²´ ìƒì„¸ ì„¤ì •</div>
        <select id="font-family" class="select" style="margin-bottom:12px;">
            <option value="NanumSquareNeo" selected>ë‚˜ëˆ”ìŠ¤í€˜ì–´ ë„¤ì˜¤</option>
            <option value="Pretendard">í”„ë¦¬í…ë‹¤ë“œ</option>
            <option value="PyeongChangPeace-Bold">í‰ì°½í‰í™”ì²´</option>
            <option value="ChosunGu">ì¡°ì„ ê²¬ê³ ë”•</option>
            <option value="KOTRA_HOPE">ì½”íŠ¸ë¼ í¬ë§ì²´</option>
            <option value="Hahmlet-Bold">í•¨ë › ì„¸ë¦¬í”„</option>
            <option value="Galmuri11">ê°ˆë¬´ë¦¬11 ë„íŠ¸</option>
            <option value="TmonMonsori">í‹°ëª¬ ëª¬ì†Œë¦¬</option>
            <option value="Bagel Fat One">ë² ì´ê¸€ íŒ»</option>
            <option value="Esamanru">ì´ì‚¬ë§Œë£¨</option>
        </select>
        <div class="range-wrap">
            <div class="range-header"><span>í°íŠ¸ êµµê¸°</span><span class="range-val" id="fw-val">900</span></div>
            <input type="range" id="font-weight" min="100" max="900" step="100" value="900">
        </div>
        <div class="range-wrap">
            <div class="range-header"><span>í°íŠ¸ í¬ê¸°</span><span class="range-val" id="fs-val">120px</span></div>
            <input type="range" id="font-size" min="40" max="250" value="120">
        </div>
    </div>

    <!-- 4. í…Œë‘ë¦¬ ë° í”„ë¦¬ì…‹ -->
    <div class="config-section">
        <div class="config-title">í…Œë‘ë¦¬ ë° í¬ì¸íŠ¸ ë°”</div>
        <select id="border-mode" class="select" style="margin-bottom:12px;">
            <option value="none">í…Œë‘ë¦¬ ì—†ìŒ</option>
            <option value="all">4ë©´ ì „ì²´ í…Œë‘ë¦¬</option>
            <option value="left" selected>ì™¼ìª½ í¬ì¸íŠ¸ ë°”</option>
            <option value="top">ìƒë‹¨ í¬ì¸íŠ¸ ë°”</option>
        </select>
        <div class="range-wrap">
            <div class="range-header"><span>í…Œë‘ë¦¬ ë‘ê»˜</span><span class="range-val" id="bw-val">30px</span></div>
            <input type="range" id="border-width" min="0" max="100" value="30">
        </div>
    </div>

    <div class="config-section">
        <div class="config-title">ì»¬ëŸ¬ í”„ë¦¬ì…‹ (20ì¢…)</div>
        <div class="preset-grid" id="preset-grid"></div>
    </div>

    <div class="config-section">
        <div class="config-title">ìƒ‰ìƒ ì§ì ‘ ì…ë ¥</div>
        <div class="color-group">
            <input type="color" id="bg-picker" class="color-input" value="#000000">
            <input type="text" id="bg-hex" class="hex-input" value="#000000">
            <label>ë°°ê²½ìƒ‰ (ì‚¬ì§„ íˆ¬ëª… ì‹œ ë³´ì„)</label>
        </div>
        <div class="color-group">
            <input type="color" id="text-picker" class="color-input" value="#ede02a">
            <input type="text" id="text-hex" class="hex-input" value="#ede02a">
            <label>ê¸€ì/í…Œë‘ë¦¬ ìƒ‰ìƒ</label>
        </div>
    </div>
</aside>

<main class="main-content">
    <div class="preview-wrap">
        <canvas id="preview-canvas" width="1000" height="1000"></canvas>
    </div>
    <button class="btn-download" id="download-btn">ê³ í™”ì§ˆ WebP ì €ì¥ (í•œê¸€ íŒŒì¼ëª…)</button>
</main>

<script>
    const canvas = document.getElementById('preview-canvas');
    const ctx = canvas.getContext('2d');

    const presets = [
        { n: 'ë„¤ì˜¨', bg: '#000000', tx: '#ede02a' }, { n: 'ìœ íŠœë¸Œ', bg: '#ffffff', tx: '#ff0000' },
        { n: 'ë„¤ì´ë²„', bg: '#ffffff', tx: '#00d179' }, { n: 'ë¯¼íŠ¸', bg: '#0f172a', tx: '#2dd4bf' },
        { n: 'ì‚¬ì´ë²„', bg: '#000000', tx: '#00f2ff' }, { n: 'ë¼ì„', bg: '#1a2e05', tx: '#bef264' },
        { n: 'í¼í”Œ', bg: '#581c87', tx: '#f5d0fe' }, { n: 'ë§ê³ ', bg: '#fbbf24', tx: '#000000' },
        { n: 'ì˜¤ë Œì§€', bg: '#fb923c', tx: '#ffffff' }, { n: 'í•‘í¬', bg: '#000000', tx: '#ff007f' },
        { n: 'ë¡œì–„', bg: '#1e3a8a', tx: '#ffffff' }, { n: 'ë¸”ë™', bg: '#000000', tx: '#ffffff' },
        { n: 'í™”ì´íŠ¸', bg: '#ffffff', tx: '#000000' }, { n: 'í¬ë ˆìŠ¤íŠ¸', bg: '#064e3b', tx: '#a7f3d0' },
        { n: 'ì»¤í”¼', bg: '#451a03', tx: '#fed7aa' }, { n: 'ê³¨ë“œ', bg: '#1c1917', tx: '#fbbf24' },
        { n: 'ìº”ë””', bg: '#fdf2f8', tx: '#db2777' }, { n: 'ê·¸ë ˆì´', bg: '#334155', tx: '#f1f5f9' },
        { n: 'ë°”ë‹¤', bg: '#0c4a6e', tx: '#bae6fd' }, { n: 'ì¬ì…‹', bg: '#7f1d1d', tx: '#fecaca' }
    ];

    let currentAlign = 'center';
    let bgImage = null;

    const el = {
        text: document.getElementById('text-input'), font: document.getElementById('font-family'),
        weight: document.getElementById('font-weight'), size: document.getElementById('font-size'),
        mode: document.getElementById('border-mode'), bWidth: document.getElementById('border-width'),
        bgP: document.getElementById('bg-picker'), bgH: document.getElementById('bg-hex'),
        txP: document.getElementById('text-picker'), txH: document.getElementById('text-hex'),
        opacity: document.getElementById('image-opacity')
    };

    presets.forEach(p => {
        const div = document.createElement('div');
        div.className = 'preset-card';
        div.innerHTML = `<div class="preset-box" style="background:${p.bg}; border:1px solid #ddd;"></div><div class="preset-label">${p.n}</div>`;
        div.onclick = () => { el.bgP.value = p.bg; el.bgH.value = p.bg.toUpperCase(); el.txP.value = p.tx; el.txH.value = p.tx.toUpperCase(); draw(); };
        document.getElementById('preset-grid').appendChild(div);
    });

    document.querySelectorAll('.align-btn').forEach(btn => {
        btn.onclick = () => { document.querySelectorAll('.align-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); currentAlign = btn.dataset.align; draw(); };
    });

    // ì‚¬ì§„ ì—…ë¡œë“œ ì²˜ë¦¬
    document.getElementById('image-upload').onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => { bgImage = img; draw(); };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
    };

    function resetImage() { bgImage = null; document.getElementById('image-upload').value = ''; draw(); }

    const sync = (p, h) => {
        p.oninput = () => { h.value = p.value.toUpperCase(); draw(); };
        h.oninput = () => { if(/^#[0-9A-F]{6}$/i.test(h.value)) { p.value = h.value; draw(); }};
    };
    sync(el.bgP, el.bgH); sync(el.txP, el.txH);

    function draw() {
        const lines = el.text.value.split('\n');
        const fs = parseInt(el.size.value);
        const fw = el.weight.value;
        const bw = parseInt(el.bWidth.value);
        const mode = el.mode.value;
        const op = parseInt(el.opacity.value) / 100;

        document.getElementById('fs-val').innerText = fs + 'px';
        document.getElementById('fw-val').innerText = fw;
        document.getElementById('bw-val').innerText = bw + 'px';
        document.getElementById('opacity-val').innerText = el.opacity.value + '%';

        // 1. ê¸°ë³¸ ë°°ê²½ìƒ‰ ì¹ í•˜ê¸°
        ctx.globalAlpha = 1.0;
        ctx.fillStyle = el.bgH.value;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 2. ë°°ê²½ ì‚¬ì§„ ê·¸ë¦¬ê¸° (ë¶ˆíˆ¬ëª…ë„ ì ìš©)
        if (bgImage) {
            ctx.globalAlpha = op;
            // ì´ë¯¸ì§€ë¥¼ ìº”ë²„ìŠ¤ì— ê½‰ ì°¨ê²Œ ê·¸ë¦¬ê¸° (Cover ë°©ì‹)
            const canvasRatio = canvas.width / canvas.height;
            const imgRatio = bgImage.width / bgImage.height;
            let drawW, drawH, drawX, drawY;

            if (imgRatio > canvasRatio) {
                drawH = canvas.height;
                drawW = canvas.height * imgRatio;
                drawX = (canvas.width - drawW) / 2;
                drawY = 0;
            } else {
                drawW = canvas.width;
                drawH = canvas.width / imgRatio;
                drawX = 0;
                drawY = (canvas.height - drawH) / 2;
            }
            ctx.drawImage(bgImage, drawX, drawY, drawW, drawH);
        }

        ctx.globalAlpha = 1.0; // íˆ¬ëª…ë„ ë³µêµ¬

        // 3. í…Œë‘ë¦¬ ë° í¬ì¸íŠ¸ ë°”
        ctx.fillStyle = el.txH.value;
        if (mode === 'all') { ctx.strokeStyle = el.txH.value; ctx.lineWidth = bw * 2; ctx.strokeRect(0, 0, canvas.width, canvas.height); }
        else if (mode === 'left') { ctx.fillRect(0, 0, bw, canvas.height); }
        else if (mode === 'top') { ctx.fillRect(0, 0, canvas.width, bw); }

        // 4. í…ìŠ¤íŠ¸ ë Œë”ë§ (ìƒí•˜ì¢Œìš° ì •ì¤‘ì•™)
        ctx.font = `${fw} ${fs}px "${el.font.value}", sans-serif`;
        ctx.textBaseline = 'middle';

        let x = canvas.width / 2;
        if (currentAlign === 'left') x = (mode === 'left' ? bw : 0) + 80;
        else if (currentAlign === 'right') x = canvas.width - 80;
        ctx.textAlign = currentAlign;

        const lh = fs * 1.35;
        const totalH = lines.length * lh;
        let startY = (canvas.height - totalH) / 2 + (lh / 2);

        // ê°€ë…ì„±ì„ ìœ„í•œ ì€ì€í•œ ê·¸ë¦¼ì
        ctx.shadowColor = "rgba(0,0,0,0.3)";
        ctx.shadowBlur = 10;

        lines.forEach((line, i) => { ctx.fillText(line, x, startY + (i * lh)); });
        ctx.shadowBlur = 0; // ê·¸ë¦¼ì ì´ˆê¸°í™”
    }

    document.getElementById('download-btn').onclick = function() {
        const rawText = el.text.value;
        let safeName = rawText.replace(/\n/g, '_').replace(/[^\w\sã„±-ã…ã…-ã…£ê°€-í£]/gi, '').trim().replace(/\s+/g, '_').replace(/__+/g, '_');
        if (!safeName) safeName = 'thumbnail';
        const dataUrl = canvas.toDataURL('image/webp', 0.85);
        const link = document.createElement('a');
        link.href = dataUrl; link.download = `${safeName.substring(0, 100)}.webp`;
        document.body.appendChild(link); link.click(); document.body.removeChild(link);
    };

    [el.text, el.font, el.weight, el.size, el.mode, el.bWidth, el.opacity].forEach(input => input.oninput = draw);
    document.fonts.ready.then(draw);
</script>

</body>
</html>

